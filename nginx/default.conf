server {
  listen 80;
  server_name 202.28.49.122;

  client_max_body_size 20m;

  # static/media by WhiteNoise (สำรองไว้ให้ Nginx เสิร์ฟได้ด้วย)
  location /static/ { alias /app/staticfiles/; access_log off; expires 30d; }
  location /media/  { alias /app/media/;      access_log off; expires 30d; }

  # ส่งทั้งหมดเข้า Django (Gunicorn) ใน service web
  location / {
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_pass http://web:8000;
  }

  # (ตัวเลือก) ให้ n8n ใช้ใต้เส้นทาง /n8n/ หากมันฟังที่ 127.0.0.1:5678
  location /n8n/ {
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_pass http://127.0.0.1:5678/;
  }
}
